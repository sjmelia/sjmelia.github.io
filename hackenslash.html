<html>
    <head>
        <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
        <script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
		<link href='http://fonts.googleapis.com/css?family=Cinzel Decorative' rel='stylesheet' type='text/css'>
        <style>
            body { font-family: Cinzel Decorative; }
            img { display: none; }
            #canvas { border: 1px black solid; }
        </style>
    </head>

    <body>
        <h1>Hackenslash</h1>
        <canvas id="canvas" width="300" height="300"></canvas>
        <img id="slash" src="hackenslash/female_slash.png"/>
        <img id="walkcycle" src="hackenslash/female_walkcycle.png"/>
    </body>

    <script type="text/javascript">
        var fps = 30;

        // http://lpc.opengameart.org/static/lpc-style-guide/assets.html#assets-character-base
        var player = function(game) {
            this.x = 0;
            this.y = 0;
            this.xvel = 0;
            this.yvel = 0;
            this.WIDTH = 64;
            this.HEIGHT = 64;
            this.slash = $('#slash')[0];
            this.walk = $('#walkcycle')[0];
            this.frame = 0;
            this.facing = 0;
            this.render = function(context) {
                if (this.xvel < 0) this.facing = 1;
                if (this.xvel > 0) this.facing = 3;
                if (this.yvel < 0) this.facing = 0;
                if (this.yvel > 0) this.facing = 2;
                var frameY = this.HEIGHT * this.facing;
                var frameX = this.frame * this.WIDTH;
                context.drawImage(this.walk, frameX, frameY, this.WIDTH, this.HEIGHT, this.x, this.y, this.WIDTH, this.HEIGHT); 
            };

            this.logic = function() {
                if (this.xvel != 0 || this.yvel != 0)
                    this.frame++;
                
                if (this.frame > 8)
                    this.frame = 0;

                this.x += this.xvel;
                this.y += this.yvel;
                if (this.x > 300-this.WIDTH) this.x = 300 - this.WIDTH;
                if (this.x < 0) this.x = 0;
                if (this.y > 300-this.HEIGHT) this.y = 300-this.HEIGHT;
                if (this.y < 0) this.y = 0;
            };
        };
        
        var game = function(width, height) {
            this.width = width;
            this.height = height;
            this.player = new player();

            this.render = function(context) {
                context.clearRect(0, 0, this.width, this.height);
                this.player.render(context);
            };

            this.logic = function() {
                this.player.logic();
            };

            this.SPEED = 3;
            this.keydown = (function(e) {
                switch(e.keyCode) {
                    case 37: this.player.xvel = -this.SPEED; break;
                    case 38: this.player.yvel = -this.SPEED; break;
                    case 39: this.player.xvel = this.SPEED; break;
                    case 40: this.player.yvel = this.SPEED; break;
                }
            }).bind(this);

            this.keyup = (function(e) {
                switch(e.keyCode) {
                    case 37: this.player.xvel = 0; break;
                    case 38: this.player.yvel = 0; break;
                    case 39: this.player.xvel = 0; break;
                    case 40: this.player.yvel = 0; break;
                }
            }).bind(this);

        }

        var canvas = $('#canvas');
        var context = canvas[0].getContext('2d');
        var instance = new game(canvas.width(), canvas.height());
        $(document).keydown(instance.keydown);
        $(document).keyup(instance.keyup);
        var gameloop = function() {
            setTimeout(function() { requestAnimationFrame(gameloop); }, 1000 / fps); 
            instance.render(context);
            instance.logic();
        };
        gameloop();
    </script>
</html>
